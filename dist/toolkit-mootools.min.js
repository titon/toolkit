/*! Titon Toolkit v1.5.1 | BSD-3 License | titon.io */
!function(a){"use strict";var b=function(){for(var a="transition WebkitTransition MozTransition OTransition msTransition".split(" "),b=document.createElement("div").style,c=0;c<a.length;c++)if(a[c]in b)return a[c];return!1}(),c={version:"1.5.1",build:"hyar4lst",vendor:"",aria:!0,messages:{loading:"Loading...",error:"An error has occurred!"},hasTransition:b,transitionEnd:function(){var a={WebkitTransition:"webkitTransitionEnd",OTransition:"oTransitionEnd otransitionend"};return a[b]||"transitionend"}(),isTouch:!!("ontouchstart"in a||a.DocumentTouch&&document instanceof DocumentTouch),isRetina:a.devicePixelRatio>1,autobox:function(a){return a="null"===typeOf(a)?null:"true"===a?!0:"false"===a?!1:isNaN(a)?String.from(a):Number.from(a)},create:function(a,b,c){var d=a,e="$"+d;c?(Elements.prototype[d]&&(d="toolkit"+d.charAt(0).toUpperCase()+d.slice(1)),Elements.implement(d,function(){var a=b.apply(this,arguments);return this.each(function(b){b[e]||(b[e]=a)})})):(Element.prototype[d]&&(d="toolkit"+d.charAt(0).toUpperCase()+d.slice(1)),Element.implement(d,function(){return this[e]||(this[e]=b.apply(this,arguments)),this}))}};a.Toolkit=c;var d=c.vendor;Element.implement({toolkit:function(a,b,c){var d=this["$"+a];return d?(b&&d[b]&&d[b].apply(d,Array.from(c)),d):null},reveal:function(){return this.swapClass("hide","show").aria("hidden",!1)},conceal:function(){return this.swapClass("show","hide").aria("hidden",!0)},isShown:function(){return"hidden"!==this.getStyle("visibility")},aria:function(a,b){return c.aria?(b===!0?b="true":b===!1&&(b="false"),this.set("aria-"+a,b)):this}.overloadSetter(),positionTo:function(b,c,d,e){var f=d||{left:0,top:0},g=0,h=0,i=this.getDimensions({computeSize:!0,styles:["padding","border","margin"]});if("domevent"===typeOf(c))f.left+=c.page.x,f.top+=c.page.y;else{var j=c.getPosition(),k=b,l=a.getSize(),m=a.getScroll().top;f.left+=j.x,f.top+=j.y,g=c.getHeight(),h=c.getWidth(),j.top-i.totalHeight-m<0?k=k.replace("top","bottom"):j.top+g+i.totalHeight>l.y&&(k=k.replace("bottom","top")),j.left-i.totalWidth<0?k=k.replace("left","right"):j.left+h+i.totalWidth>l.x&&(k=k.replace("right","left")),b!==k&&(this.removeClass(b).addClass(k).set("data-new-position",k),b=k)}var n=b.split("-"),o={y:n[0],x:n[1]};return"top"===o.y?f.top-=i.totalHeight:"bottom"===o.y?f.top+=g:"center"===o.y&&(f.top-=Math.round(i.totalHeight/2-g/2)),"left"===o.x?f.left-=i.totalWidth:"right"===o.x?f.left+=h:"center"===o.x&&(f.left-=Math.round(i.totalWidth/2-h/2)),e&&("center"===o.y&&("left"===o.x?f.left-=15:"right"===o.x&&(f.left+=15)),"center"===o.x&&("top"===o.y?f.top-=10:"bottom"===o.y&&(f.top+=20))),this.setStyles(f)}}),Array.implement({chunk:function(a){var b=this;return[].concat.apply([],b.map(function(c,d){return d%a?[]:[b.slice(d,d+a)]}))}}),Number.implement({bound:function(a,b){var c=this;return b=b||0,c>=a?c=0:b>c&&(c=a-1),c}}),Function.implement({debounce:function(a,b){var c,d=this;return function(){var e=this,f=arguments;clearTimeout(c),c=setTimeout(function(){c=null,b||d.apply(e,f)},a||150),b&&!c&&d.apply(e,f)}}}),Element.Events.clickout=function(){function a(a){var b=!0;return c.each(function(c){b&&(b=c!==a.target&&0===c.getElements(a.target).length)}),b}function b(b){a(b)&&c.fireEvent("clickout",[b.target])}var c=new Elements;return{base:"click",condition:a,onAdd:function(){c.push(this),1===c.length&&document.addEvent("click",b)},onRemove:function(){c.pop(this),0===c.length&&document.removeEvent("click",b)}}}(),Element.Properties.html.set=function(a){var b=typeOf(a);return"element"===b?(this.innerHTML="",this.appendChild(a),this):("string"===b&&a.match(/^#[a-z0-9_\-\.:]+$/i)?a=document.getElement(a).get("html"):"array"===b&&(a=a.join("")),this.innerHTML=a,this)},Element.NativeEvents.transitionend=2,c.Component=new Class({Implements:[Events,Options],Binds:["onShow","onHide","position"],uid:0,cache:{},events:{},enabled:!1,element:null,nodes:null,node:null,options:{cache:!0,context:null,delegate:"",className:"",template:"",templateFrom:""},runtime:{},initialize:function(a){this.setOptions(a||{});var b=this.className();c[b].count=c[b].count||0,this.uid=c[b].count+=1,this.cssClass=b.hyphenate().slice(1),this.keyName=b.charAt(0).toLowerCase()+b.slice(1)},bindEvents:function(b){var c,e,f,g,h,i=this,j=this.options,k=a,l=document,m="on"===b?"addEvent":"removeEvent";return Object.each(this.events,function(a,b){h="array"===typeOf(a)?a:[a],b=b.replace("{mode}",j.mode),b=b.replace("{selector}",j.delegate||""),e=b.split(" "),c=e.shift(),f=e.shift(),g=e.join(" ").replace("@",d),"undefined"!=typeof i[f]?f=i[f]:"window"===f?f=k:"document"===f&&(f=l),("array"!==typeOf(f)||f.length)&&h.each(function(a){"function"!==typeOf(a)&&(a=i[a]),"ready"===c?k[m]("domready",a):"clickout"===c?$$(g||f)[m](c,a):g?f[m](c+":relay("+g+")",a):f[m](c,a)})}),this},className:function(){return Object.keyOf(a.Toolkit,this.$constructor)},createElement:function(){var a,b=this.options;if(this.element)return this;if(b.templateFrom&&(a="element"===typeOf(b.templateFrom)?b.templateFrom:document.getElement(b.templateFrom)),!a&&b.template&&(a=this.parseTemplate(b.template),a&&a.conceal().inject(document.body)),!a)throw new Error(this.className()+" failed to create template element");return b.className&&a.addClass(b.className),b.animation&&a.addClass(b.animation),a.set("id",this.id()),this.element=a,this.created=!0,this},destroy:function(){this.fireEvent("destroy"),this.hide(),this.doDestroy&&this.doDestroy(),this.disable(),this.created&&this.element.dispose();var a=this.keyName;return this.nodes?this.nodes.each(function(b){delete b["$"+a]}):this.element&&delete this.element["$"+a],this},disable:function(){return this.enabled&&this.bindEvents("off"),this.enabled=!1,this},enable:function(){return this.enabled||this.bindEvents("on"),this.enabled=!0,this},hide:function(a){return this.element&&this.element!==document.body&&this.element.conceal(),"function"===typeOf(a)&&a(),this.fireEvent("hide"),this},id:function(){var a=Array.slice(arguments);return a.unshift("toolkit",this.cssClass,this.uid),a.join("-")},inheritOptions:function(a,b){var d,e,f={};for(d in a)"context"!==d&&"template"!==d&&(e=b.get(("data-"+this.keyName+"-"+d).toLowerCase()),"null"!==typeOf(e)&&(f[d]=c.autobox(e)));return Object.merge({},a,f)},isVisible:function(){return this.element&&this.element.isShown()},parseTemplate:function(a){if(!a)return null;if("element"===typeOf(a))return a;var b=Elements.from(a);if(b[0])return b[0];throw new Error(this.className()+" template failed to parse")},position:function(a){return this.element.set("html",a),this.fireEvent("load",a),this},process:function(b){if(this.hide(),b.callback){for(var c=b.callback.split("."),d=a,e=d,f=0;f<c.length;f++)e=d,d=d[c[f]];d.call(e,b)}return this.fireEvent("process",b),this},readOption:function(a,b){var d=a.get(("data-"+this.keyName+"-"+b).toLowerCase());return d="null"===typeOf(d)?this.options[b]:c.autobox(d)},readValue:function(a,b){return b?"function"===typeOf(b)?b.call(this,a):a.get(b):null},requestData:function(a,b,d,e){var f=a.url||a,g=Object.merge({url:f,method:"GET",evalScripts:!0,onRequest:b||function(){this.cache[f]=!0,this.element.addClass("is-loading").aria("busy",!0)}.bind(this)},a);"object"===typeOf(this.options.ajax)&&(g=Object.merge({},this.options.ajax,g));var h=this,i="GET"===g.method.toUpperCase()&&this.options.cache;return g.onSuccess=d||function(a){var b=this.xhr.getResponseHeader("Content-Type");h.element.removeClass("is-loading").aria("busy",!1),b.indexOf("text/html")>=0?(i?h.cache[f]=a:delete h.cache[f],h.position(a)):(delete h.cache[f],"application/json"===b&&(a=JSON.parse(a)),h.process(a))},g.onFailure=e||function(){delete this.cache[f],this.element.removeClass("is-loading").addClass("has-failed").aria("busy",!1),this.position(c.messages.error)}.bind(this),new Request(g).send(),this},setOptions:function(a,b){if(a=Object.merge({},this.options,a||{}),b&&(a=this.inheritOptions(a,b)),a.mode&&"hover"===a.mode&&(a.mode=c.isTouch?"click":"mouseenter"),this.addEvent)for(var d in a)"function"===typeOf(a[d])&&/^on[A-Z]/.test(d)&&(this.addEvent(d,a[d]),delete a[d]);return this.options=a,this},show:function(a){return this.node=a,this.element.reveal(),this.fireEvent("show"),this},onHide:function(a){"domevent"===typeOf(a)&&a.preventDefault();var b=this.element;(!b||b.isShown()&&!b.hasClass("is-loading"))&&this.hide()},onShow:function(a,b){if(this.enabled){if(b=b||a.target,this.isVisible()){if(c.isTouch?(b!==this.node||"a"!==this.node.get("tag"))&&a.preventDefault():a.preventDefault(),"click"===this.options.mode&&this.hide(),b===this.node)return}else"domevent"===typeOf(a)&&a.preventDefault();this.show(b)}}}),c.Accordion=new Class({Extends:c.Component,headers:[],sections:[],index:0,options:{mode:"click",defaultIndex:0,multiple:!1,collapsible:!1},initialize:function(a,b){this.parent(b),this.element=a,this.options=b=this.inheritOptions(this.options,a);var c=a.getElements("."+d+"accordion-section"),e=a.getElements("."+d+"accordion-header"),f=this;this.headers=e,this.sections=c,a.set("role","tablist"),e.each(function(a,b){a.set("data-index",b).set("role","tab").set("id",f.id("header",b)).aria({controls:f.id("section",b),selected:!1,expanded:!1})}),c.each(function(a,b){a.set("data-height",a.getHeight()).set("role","tabpanel").set("id",f.id("section",b)).aria("labelledby",f.id("header",b)).conceal()}),this.events={"{mode} element .@accordion-header":"onShow"},this.enable(),this.fireEvent("init"),this.jump(b.defaultIndex)},doDestroy:function(){this.element.reveal(),this.headers.getParent().removeClass("is-active"),this.sections.removeProperty("style").reveal()},jump:function(a){return a=Number.from(a).bound(this.headers.length),this.fireEvent("jump",a),this.show(this.headers[a])},show:function(a){var b=this.options,c=a.getParent(),d=a.getNext(),e=a.get("data-index"),f=d.get("data-height").toInt(),g={selected:!1,expanded:!1},h={selected:!0,expanded:!0};if("click"===b.mode&&(b.multiple||b.collapsible&&this.node===a))d.isShown()&&this.node?(d.setStyle("max-height",0).conceal(),c.removeClass("is-active"),a.aria(g)):(d.setStyle("max-height",f).reveal(),c.addClass("is-active"),a.aria(h));else{if(this.node===a)return this;this.sections.setStyle("max-height",0).conceal(),d.setStyle("max-height",f).reveal(),this.headers.aria(g),a.aria(h),this.element.getChildren("li").removeClass("is-active"),c.addClass("is-active")}return this.index=e,this.node=a,this.fireEvent("show",[d,a,e]),this},onShow:function(a){a.preventDefault();for(var b=a.target,c=this.headers;!c.contains(b);)b=b.getParent();b&&this.show(b)}}),c.create("accordion",function(a){return new c.Accordion(this,a)}),c.Blackout=new Class({Extends:c.Component,count:0,loader:null,message:null,options:{loader:"bar-wave",waveCount:5,template:'<div class="'+d+'blackout"></div>',templateFrom:"#toolkit-blackout-1"},initialize:function(a){this.parent(a),this.createElement(),this.createLoader(),this.fireEvent("init")},createLoader:function(){var a=this.options,b="bubble-spinner"===a.loader?8:a.waveCount;this.loader=new Element("div."+d+"loader."+a.loader).inject(this.element);var e,f="";for(e=0;b>e;e++)f+="<span></span>";"bubble-spinner"===a.loader?new Element("div."+d+"loader-spinner").set("html",f).inject(this.loader):this.loader.set("html",f),this.message=new Element("div."+d+"loader-message").set("html",c.messages.loading).inject(this.loader)},hide:function(){var a=this.count-1;return 0>=a?(this.count=0,this.element.conceal(),this.hideLoader()):this.count=a,this.fireEvent("hide",0>=a),this},hideLoader:function(){return this.loader.conceal(),this.fireEvent("hideLoader"),this},show:function(){var a=!1;return this.count++,1===this.count&&(this.element.reveal(),a=!0),this.showLoader(),this.fireEvent("show",a),this},showLoader:function(){return this.loader.reveal(),this.fireEvent("showLoader"),this}});var e=null;c.Blackout.factory=function(a){return e?e:e=new c.Blackout(a)},a.Cache=new Class({storage:null,setStorage:function(b){if(!a.JSON)throw new Error("JSON is required for caching and storage");switch(b.toLowerCase()){case"local":case"localstorage":if(a.localStorage)try{return a.localStorage.setItem("_temp_","Titon"),a.localStorage.removeItem("_temp_"),void(this.storage=a.localStorage)}catch(c){}case"session":case"sessionstorage":if(a.sessionStorage)try{return a.sessionStorage.setItem("_temp_","Titon"),a.sessionStorage.removeItem("_temp_"),void(this.storage=a.sessionStorage)}catch(d){}default:this.storage=function(){var a={},b=0;return{length:b,clear:function(){a={},b=0},getItem:function(b){return a[b]||null},setItem:function(c,d){a[c]=d,b++},removeItem:function(c){delete a[c],b--}}}()}},cacheSize:function(){return this.storage.length||0},flushCache:function(){this.storage&&this.storage.clear()},getCache:function(a){if(this.storage&&a){var b=this.storage.getItem(a);if(b)return JSON.parse(b)}return null},hasCache:function(a){return this.storage&&this.storage.getItem(a)},setCache:function(a,b){if(this.storage&&a)try{return this.storage.setItem(a,JSON.stringify(b||"")),!0}catch(c){}return!1},removeCache:function(a){this.storage&&a&&this.storage.removeItem(a)}}),c.Carousel=new Class({Extends:c.Component,Binds:["next","prev","start","stop","resize","onCycle","onJump","onKeydown","onSwipe"],stopped:!1,itemsWrapper:null,itemsList:null,items:[],tabsWrapper:null,tabs:[],prevButton:null,nextButton:null,index:0,timer:null,options:{animation:"slide",duration:5e3,autoCycle:!0,stopOnHover:!0},initialize:function(a,b){this.parent(b),this.element=a,this.options=b=this.inheritOptions(this.options,a);var c,e=this;switch(this.items=c=a.getElements("."+d+"carousel-items li").each(function(a,b){a.set({role:"tabpanel",id:e.id("item",b)}).aria("hidden",b>0)}),a.getElements("."+d+"carousel-tabs").set("role","tablist"),this.tabs=a.getElements("."+d+"carousel-tabs a").each(function(a,b){a.set({"data-index":b,role:"tab",id:e.id("tab",b)}).aria({controls:e.id("item",b),selected:!1,expanded:!1})}),a.aria("live",b.autoCycle?"assertive":"off").addClass(b.animation),this.events={"keydown window":"onKeydown","swipe element":"onSwipe","click element .@carousel-tabs a":"onJump","click element .@carousel-next":"next","click element .@carousel-prev":"prev"},b.stopOnHover&&(this.events["mouseenter element"]="stop",this.events["mouseleave element"]="start"),this.enable(),this.fireEvent("init"),b.animation){case"fade":c[0].reveal();break;case"slide":c[0].getParent().setStyle("width",100*c.length+"%"),c.setStyle("width",100/c.length+"%")}this.reset().start()},doDestroy:function(){clearInterval(this.timer),this.stop(),this.element.reveal()},jump:function(a){if(a=Number.from(a).bound(this.items.length),a===this.index)return this;this.tabs.removeClass("is-active").aria({expanded:!1,selected:!1}),this.tabs[a]&&this.tabs[a].addClass("is-active").aria({expanded:!0,selected:!0}),this.items.aria("hidden",!0),this.items[a]&&this.items[a].aria("hidden",!1);var b=this.options.animation;return"fade"===b?(this.items.removeClass("show"),this.items[a].reveal()):this.items.getParent().setStyle("slide-up"===b?"top":"left",-(100*a)+"%"),this.index=a,this.reset(),this.fireEvent("jump",a),this},next:function(){return this.jump(this.index+1),this},prev:function(){return this.jump(this.index-1),this},reset:function(){return this.options.autoCycle&&(clearInterval(this.timer),this.timer=setInterval(this.onCycle,this.options.duration)),this},start:function(){return this.element.removeClass("is-stopped"),this.stopped=!1,this.fireEvent("start"),this},stop:function(){return this.element.addClass("is-stopped"),this.stopped=!0,this.fireEvent("stop"),this},onCycle:function(){this.stopped||(this.fireEvent("cycle",this.index),this.next())},onJump:function(a){a.preventDefault(),this.jump(a.target.get("data-index")||0)},onKeydown:function(a){if(["up","down","left","right"].contains(a.key))switch(a.preventDefault(),a.key){case"up":this.jump(0);break;case"down":this.jump(-1);break;case"left":this.prev();break;case"right":this.next()}},onSwipe:function(a){"left"===a.direction?this.next():"right"===a.direction&&this.prev()}}),c.create("carousel",function(a){return new c.Carousel(this,a)}),c.Drop=new Class({Extends:c.Component,options:{delegate:".js-drop",getTarget:"data-drop",hideOpened:!0},initialize:function(a,b){this.parent(b),this.nodes=a,this.events={"clickout document .@drop":"onHide","clickout document {selector}":"onHide","{mode} document {selector}":"onShow"},this.enable(),this.fireEvent("init")},hide:function(){return this.parent(function(){this.node&&this.node.aria({selected:!1,expanded:!1}).removeClass("is-active")}.bind(this))},show:function(a){return this.parent(a),this.node.aria({selected:!0,expanded:!0}).addClass("is-active"),this},onShow:function(a,b){"domevent"===typeOf(a)&&a.preventDefault();var c=this.readValue(b,this.options.getTarget);c&&"#"===c.substr(0,1)&&(this.options.hideOpened&&this.node&&this.node!==b&&this.hide(),this.element=document.id(c.slice(1)),this.node=b,this.isVisible()?this.hide():this.show(b))}}),c.create("drop",function(a){return new c.Drop(this,a)},!0),a.Timers=new Class({timers:{},$timers:{},addTimer:function(a,b){return this.timers[a]=Function.from(b),this},addTimers:function(a){for(var b in a)this.addTimer(b,a[b]);return this},startTimer:function(a,b,c){return this.clearTimer(a),this.timers[a]&&(this.$timers[a]=this.timers[a].delay(b,this,c)),this},startInterval:function(a,b,c){return this.clearTimer(a),this.timers[a]&&(this.$timers[a]=this.timers[a].periodical(b,this,c)),this},clearTimer:function(b,c,d){return a.clearTimeout(this.$timers[b]),delete this.$timers[b],"function"===typeOf(c)&&c.apply(this,d||[]),this},clearTimers:function(a){return a?Array.from(a).each(function(a){this.clearTimer(a)},this):Object.each(this.$timers,function(a,b){this.clearTimer(b)},this),this},removeTimer:function(a){return delete this.timers[a],this},removeTimers:function(a){return Array.from(a).each(function(a){this.removeTimer(a)},this),this}}),c.Flyout=new Class({Extends:c.Component,Binds:["onEnter","onLeave"],Implements:[Timers],current:null,menus:{},data:[],dataMap:{},options:{delegate:".js-flyout",mode:"hover",getUrl:"href",xOffset:0,yOffset:0,showDelay:350,hideDelay:1e3,itemLimit:15,template:'<div class="flyout"></div>'},initialize:function(a,b,d){if(!c.isTouch){if(this.parent(d),this.nodes=a,!b)throw new Error("Flyout URL required to download sitemap JSON");d=this.options,this.addTimers({show:this.position,hide:this.onHide}),"click"===d.mode?this.events["click document {selector}"]="onShow":(this.events["mouseenter document {selector}"]=["onShow","onEnter"],this.events["mouseleave document {selector}"]="onLeave"),this.enable(),this.fireEvent("init"),new Request.JSON({url:b,secure:!0,onSuccess:this.load.bind(this)}).get()}},doDestroy:function(){Object.each(this.menus,function(a){a.dispose()}),this.clearTimer("show"),this.clearTimer("hide")},hide:function(){return this.clearTimers(),this.node&&this.node.removeClass("is-active"),this.current&&this.isVisible()?(this.menus[this.current].conceal(),this.fireEvent("hide"),this.current=null,this):this},isVisible:function(){return this.current&&this.menus[this.current]&&(this.element=this.menus[this.current]),this.parent()},load:function(a,b){if(b=b||0,0===b&&(this.data=a),a.url&&(this.dataMap[a.url]=a),a.children)for(var c=0,d=a.children.length;d>c;c++)this.load(a.children[c],b+1);return this},position:function(){var b=this.current,c=this.options;if(!this.menus[b])return this;var d=this.menus[b],e=d.getDimensions().height,f=this.node.getCoordinates(),g=f.left+c.xOffset,h=f.top+c.yOffset+f.height,i=a.getScrollSize();return h>i.y/2&&(h=f.top-c.yOffset-e),d.setPosition({x:g,y:h}).reveal(),this.fireEvent("show"),this},show:function(a){var b=this._getTarget(a);return this.current&&b!==this.current&&(this.hide(),this.startTimer("show",this.options.showDelay)),this.node=a,this._getMenu()?(this.node.addClass("is-active"),"click"===this.options.mode&&this.position(),this):this},_buildMenu:function(a,b){if(!b.children||!b.children.length)return null;var c,e,f,g=this.options,h=this.parseTemplate(g.template),i=[],j=g.itemLimit;h.set("role","menu").aria("hidden",!0),g.className&&h.addClass(g.className),a===document.body?h.addClass("is-root"):h.aria("expanded",!1),j&&b.children.length>j?i=b.children.chunk(j):i.push(b.children);for(var k,l=0;k=i[l];l++){c=new Element("ul");for(var m,n=0,o=k.length;o>n;n++)m=k[n],e=new Element("li"),m.url?(f=new Element("a",{text:m.title,href:m.url,role:"menuitem"}),new Element("span").addClass(m.icon||"caret-right").inject(f,"top")):(f=new Element("span",{text:m.title,role:"presentation"}),e.addClass(d+"flyout-heading")),m.attributes&&f.set(m.attributes),m.className&&e.addClass(m.className),e.grab(f).inject(c),m.children&&m.children.length&&(this._buildMenu(e,m),e.addClass("has-children").aria("haspopup",!0).addEvent("mouseenter",this.onPositionChild.bind(this,e)).addEvent("mouseleave",this.onHideChild.bind(this,e)));h.grab(c)}return h.inject(a),h}.protect(),_getMenu:function(){var a=this._getTarget();if(this.menus[a])return this.current=a,this.menus[a];if(this.dataMap[a]){var b=this._buildMenu(document.body,this.dataMap[a]);return b?(b.conceal(),"click"!==this.options.mode&&b.addEvents({mouseenter:function(){this.clearTimer("hide")}.bind(this),mouseleave:function(){this.startTimer("hide",this.options.hideDelay)}.bind(this)}),this.current=a,this.menus[a]=b,this.menus[a]):null}return null}.protect(),_getTarget:function(a){return a=a||this.node,this.readValue(a,this.options.getUrl)||a.get("href")}.protect(),onEnter:function(){this.clearTimer("hide").startTimer("show",this.options.showDelay)},onHideChild:function(a){a.removeClass("is-open"),a.getChildren("."+d+"flyout").removeProperty("style").aria({expanded:!1,hidden:!0}),this.fireEvent("hideChild",a)},onLeave:function(){this.clearTimer("show").startTimer("hide",this.options.showDelay)},onPositionChild:function(b){var c=b.getElement("."+d+"flyout");if(c){c.aria({expanded:!0,hidden:!1});var e=c.getChildren("ul");c.setStyle("width",e.getWidth()[0]*e.length+"px");var f=a.getScrollSize(),g=a.getCoordinates(),h=b.getCoordinates(),i=c.getCoordinates(),j=h.right+i.width;j>=g.width?c.addClass("push-left"):c.removeClass("push-left"),h.top>f.y/2?c.setStyle("top","-"+(i.height-h.height)+"px"):c.setStyle("top",0),b.addClass("is-open"),this.fireEvent("showChild",b)}}}),c.create("flyout",function(a,b){return new c.Flyout(this,a,b)},!0),c.Input=new Class({Extends:c.Component,wrapper:null,input:null,options:{checkbox:'input[type="checkbox"]',radio:'input[type="radio"]',select:"select",copyClasses:!0},initialize:function(a,b){this.parent(b),this.element=a,this.options=b=this.inheritOptions(this.options,a),b.checkbox&&a.getElements(b.checkbox).inputCheckbox(b),b.radio&&a.getElements(b.radio).inputRadio(b),b.select&&a.getElements(b.select).inputSelect(b),this.enable(),this.fireEvent("init")},buildWrapper:function(a){return this.wrapper=new Element("div."+d+"custom-input").wraps(a),this.options.copyClasses&&this.copyClasses(a,this.wrapper),this},copyClasses:function(a,b){var c=(a.get("class")||"").replace(/\binput\b/,"").trim();return c&&b.addClass(c),this},doDestroy:function(){var a=this.options,b=this.element;"Input"===this.className()?(this.element.reveal(),a.checkbox&&b.getElements(a.checkbox).each(function(a){a.toolkit("inputCheckbox","destroy")}),a.radio&&b.getElements(a.radio).each(function(a){a.toolkit("inputRadio","destroy")}),a.select&&b.getElements(a.select).each(function(a){a.toolkit("inputSelect","destroy")})):this.input.replaces(this.wrapper).removeProperty("style")}}),c.InputCheckbox=new Class({Extends:c.Input,initialize:function(a,b){this.input=a,this.setOptions(b,a),this.buildWrapper(a),this.element=new Element("label."+d+"checkbox").set("for",a.get("id")).inject(a,"after"),this.enable(),this.fireEvent("init")}}),c.InputRadio=new Class({Extends:c.Input,initialize:function(a,b){this.input=a,this.setOptions(b,a),this.buildWrapper(a),this.element=new Element("label."+d+"radio").set("for",a.get("id")).inject(a,"after"),this.enable(),this.fireEvent("init")}}),c.InputSelect=new Class({Extends:c.Input,Binds:["buildOption","onChange","onCycle","onToggle"],dropdown:null,multiple:!1,index:0,options:{"native":c.isTouch,multipleFormat:"count",countMessage:"{count} of {total} selected",listLimit:3,hideOpened:!0,hideFirst:!1,hideSelected:!1,arrowContent:'<span class="caret-down"></span>',getDefaultLabel:"title",getOptionLabel:"title",getDescription:"data-description"},initialize:function(a,b){if(this.input=a,this.setOptions(b,a),this.multiple=a.multiple,!a.multiple||!this.options.native){var c={"change input":"onChange"};this.buildWrapper(a),this.buildButton(a),this.options.native||(c["blur input"]="hide",c["clickout document .@select-options"]="hide",c["clickout element"]="hide",c["click element"]="onToggle",this.multiple||(c["keydown window"]="onCycle"),this.buildDropdown(a),a.setStyle("z-index",1)),this.events=c,this.enable(),this.fireEvent("init"),this.input.fireEvent("change",{target:a})}},buildButton:function(a){return this.element=new Element("div."+d+"select").grab(new Element("div."+d+"select-arrow").set("html",this.options.arrowContent)).grab(new Element("div."+d+"select-label").set("text",c.messages.loading)).setStyle("min-width",a.getWidth()).inject(a,"after"),this.multiple&&this.input.setStyle("max-height",this.element.getHeight()),this},buildDropdown:function(a){var b=this.options,c=this.buildOption,e=new Element("div."+d+"drop."+d+"drop--down."+d+"select-options"),f=new Element("ul"),g=0;return e.set("role","listbox").aria("multiselectable",this.multiple),this.dropdown=e,Array.from(a.children).each(function(a){"optgroup"===a.get("tag")?(0===g&&(b.hideFirst=!1),f.grab(new Element("li").addClass(d+"drop-heading").set("text",a.get("label"))),Array.from(a.children).each(function(b){a.disabled&&(b.disabled=!0),b.selected&&(this.index=g),f.grab(c(b,g)),g++},this)):(a.selected&&(this.index=g),f.grab(c(a,g)),g++)},this),b.hideSelected&&!b.multiple&&e.addClass("hide-selected"),b.hideFirst&&e.addClass("hide-first"),a.multiple&&e.addClass("is-multiple"),this.wrapper.grab(e.grab(f)),this},buildOption:function(a,b){var c,e=this.input,f=this.dropdown,g="is-active",h=a.selected,i=new Element("li"),j=a.textContent;h&&i.addClass(g),(c=this.readValue(a,this.options.getDescription))&&(j+=' <span class="'+d+'drop-desc">'+c+"</span>");var k=new Element("a").set({html:j,href:"javascript:;",role:"option"}).aria("selected",h);if(this.options.copyClasses&&this.copyClasses(a,i),i.grab(k),a.disabled)return i.addClass("is-disabled"),k.aria("disabled",!0),i;if(this.multiple)k.addEvent("click",function(){var b=!1;a.selected?this.getParent().removeClass(g):(b=!0,this.getParent().addClass(g)),a.selected=b,this.aria("selected",b),e.fireEvent("change",{target:e})});else{var l=this;k.addEvent("click",function(){f.getElements("li").removeClass(g),f.getElements("a").aria("selected",!1),this.getParent().addClass(g),this.aria("selected",!0),l.hide(),l.index=b,e.set("value",a.value),e.fireEvent("change",{target:e})})}return i},hide:function(){return this.element&&this.element.removeClass("is-active"),this.dropdown&&this.dropdown.conceal(),this.fireEvent("hide"),this},show:function(){return this.options.hideOpened&&$$("."+d+"drop.select-options").each(function(a){a.getSiblings("select").toolkit("inputSelect","hide")}),this.element.addClass("is-active"),this.dropdown&&this.dropdown.reveal(),this.fireEvent("show"),this},_loop:function(a,b,c){var d=this.options.hideFirst;for(a+=b;"undefined"==typeof c[a]||c[a].disabled||0===a&&d;)a+=b,a>=c.length?a=0:0>a&&(a=c.length-1);return a},onChange:function(a){var b=a.target,c=b.getElements("option"),e=[],f=[];if(c.each(function(a){a.selected&&(e.push(a),f.push(this.readValue(a,this.options.getOptionLabel)||a.textContent))},this),this.multiple){var g=this.readValue(b,this.options.getDefaultLabel),h=this.options.multipleFormat,i=f.length;if(!f.length&&g)f=g;else if("count"===h)f=this.options.countMessage.replace("{count}",i).replace("{total}",c.length);else if("list"===h){var j=this.options.listLimit;f=f.splice(0,j).join(", "),i>j&&(f+=" ...")}}else f=f.join(", ");b.getParent().getElement("."+d+"select-label").set("text",f),this.fireEvent("change",[b.get("value"),e])},onCycle:function(a){if(this.dropdown.isVisible()&&["up","down","enter","esc"].contains(a.key)){a.preventDefault();var b=this.input.getElements("option"),c=this.dropdown.getElements("a"),d="is-active",e=this.index;switch(a.key){case"enter":case"esc":return void this.hide();case"up":e=this._loop(e,-1,b);break;case"down":e=this._loop(e,1,b)}b.set("selected",!1),b[e].selected=!0,c.getParent().removeClass(d),c[e].getParent().addClass(d),this.index=e,this.input.fireEvent("change",{target:this.input})}},onToggle:function(){this.input.disabled||(this.dropdown.isShown()?this.hide():this.show())}}),c.create("input",function(a){return new c.Input(this,a)}),c.create("inputRadio",function(a){return new c.InputRadio(this,a)}),c.create("inputCheckbox",function(a){return new c.InputCheckbox(this,a)}),c.create("inputSelect",function(a){return new c.InputSelect(this,a)}),c.LazyLoad=new Class({Extends:c.Component,Binds:["load","loadAll","onReady"],container:null,elements:[],isLoaded:!1,loaded:0,options:{forceLoad:!1,delay:1e4,threshold:150,throttle:50,context:null},initialize:function(b,c){this.parent(c),this.options=this.inheritOptions(this.options,b),this.container="auto"===b.getStyle("overflow")?b:a,this.elements=b.getElements(".lazy-load");var d,e=this.options.throttle;this.events=d={"ready document":"onReady"},d["scroll:throttle("+e+") container"]="load",d["resize:throttle("+e+") window"]="load",this.enable(),this.fireEvent("init")},doDestroy:function(){this.loadAll()},inViewport:function(b){var c=this.container,d=this.options.threshold,e=c.getSize(),f=c.getScroll(),g=b.getPosition(c===a?document.body:c);return b.isVisible()&&g.y>=f.y-d&&g.y<=f.y+e.y+d&&g.x>=f.x-d&&g.x<=f.x+e.x+d},load:function(){return this.loaded>=this.elements.length?(this.shutdown(),!1):(this.elements.each(function(a,b){a&&this.inViewport(a)&&this.show(a,b)},this),this.fireEvent("load"),!0)},loadAll:function(){return this.elements.each(function(a,b){a&&this.show(a,b)},this),this.fireEvent("loadAll"),this.shutdown(),!0},show:function(a,b){return a.removeClass("lazy-load"),a.getElements("img").each(function(a){var b;c.isRetina&&(b=a.get("data-src-retina")),b||(b=a.get("data-src")),b&&a.set("src",b)}),this.elements.splice(b,1,null),this.loaded++,this.fireEvent("show",a),this},shutdown:function(){return this.enabled&&(this.disable(),this.fireEvent("shutdown")),this},onReady:function(){this.load(),this.options.forceLoad&&setTimeout(this.loadAll.bind(this),this.options.delay)}}),c.create("lazyLoad",function(a){return new c.LazyLoad(this,a)}),c.Mask=new Class({Extends:c.Component,Binds:["toggle"],mask:null,message:null,options:{selector:"",revealOnClick:!1,messageContent:""},initialize:function(a,b){this.parent(b),this.element=a,this.options=b=this.inheritOptions(this.options,a);var c="."+d+"mask";a!==document.body&&(a.addClass(d+"mask-target"),"static"===a.getStyle("position")&&a.setStyle("position","relative")),this.setMask(a.getElement("> "+c)||new Element("div"+c)),b.selector&&(this.events={},this.events["click document "+b.selector]="toggle"),this.enable(),this.fireEvent("init")},doDestroy:function(){this.mask.dispose(),this.element.removeClass(d+"mask-target").removeClass("is-masked").setStyle("position","")},hide:function(){return this.mask.conceal(),this.element.removeClass("is-masked"),this.fireEvent("hide"),this},setMask:function(a){var b=this.options;return a.addClass("hide").inject(this.element,"bottom"),this.element===document.body&&a.setStyle("position","fixed"),b.revealOnClick&&a.addEvent("click",this.onHide),this.mask=a,this.message=a.getElement("> ."+d+"mask-message"),this.message||(this.message=new Element("div."+d+"mask-message").inject(a,"bottom"),b.messageContent&&this.message.set("html",b.messageContent)),this},show:function(a){return this.node=a,this.mask.reveal(),this.element.addClass("is-masked"),this.fireEvent("show"),this},toggle:function(){return this.mask.isShown()?this.hide():this.show()}}),c.create("mask",function(a){return new c.Mask(this,a)}),c.Matrix=new Class({Extends:c.Component,Binds:["onResize","onLoad"],items:[],matrix:[],wrapperWidth:0,colWidth:0,colCount:0,images:[],imagesLoaded:0,options:{width:200,gutter:20,rtl:!1,defer:!0,template:!1},initialize:function(a,b){this.parent(b),this.element=a,this.options=this.inheritOptions(this.options,a),a.addClass(d+"matrix"),this.items=a.getElements("> li"),this.events={"resize window":this.onResize.debounce()},this.enable(),this.fireEvent("init"),this.options.defer?this._deferRender():this.render()},append:function(a){return a.inject(this.element,"bottom").setStyle("opacity",0),this.refresh()},doDestroy:function(){this.element.removeProperty("style"),this.items.removeProperty("style")},prepend:function(a){return a.inject(this.element,"top").setStyle("opacity",0),this.refresh()},refresh:function(){return this.items=this.element.getElements("> li"),this.render()},remove:function(a){return this.items.every(function(b){return b===a?(b.destroy(),!1):!0}),this.refresh()},render:function(){return this._calculateColumns(),this.items.length<this.colCount?this.element.removeProperty("style"):this.colCount<=1?(this.element.addClass("no-columns"),this.items.removeProperty("style")):(this.element.removeClass("no-columns"),this._organizeItems(),this._positionItems()),this.fireEvent("render"),this},_calculateColumns:function(){var a,b=this.element.getSize().x,c=this.options.width,d=this.options.gutter,e=Math.max(Math.floor(b/c),1),f=e*(c+d)-d;return e>1&&(f>b?(a=f-b,c-=a/e):b>f&&(a=b-f,c+=a/e)),this.wrapperWidth=b,this.colWidth=c,this.colCount=e,this}.protect(),_deferRender:function(){return this.imagesLoaded=0,this.images=this.element.getElements("img"),this.images.length?this.images.each(function(a){var b=a.src;a.onload=this.onLoad,a.onerror=this.onLoad,a.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",a.src=b},this):this.render(),this}.protect(),_organizeItems:function(){var a,b,c,d=0,e=this.items.length;this.matrix=[];for(var f=0;e>f;f++){if(a=this.items[f],c=a.getSize(),b=Math.max(Math.round(c.x/this.colWidth),1),this.matrix.push({item:a,span:b}),b>1)for(var g=1;b>g;g++)d++,this.matrix&&this.matrix.push({item:a,span:!1});d++,d>=this.colCount&&(d=0)}return this}.protect(),_positionItems:function(){var a,b,c,d,e,f,g=this.options.gutter,h=this.matrix,i=this.options.rtl?"right":"left",j=0,k=[],l=0,m={margin:0,position:"absolute"};for(d=0;d<this.colCount;d++)k.push(0);for(d=0,e=h.length;e>d;d++){if(a=h[d],b=a.span,(l>=this.colCount||b+l>this.colCount)&&(l=0,j=0),b){for(c=0,f=0;b>f;f++)k[l+f]>c&&(c=k[l+f]);for(m.top=c,m[i]=j,m.width=(this.colWidth+g)*b-g,a.item.setStyles(m).reveal(),f=0;b>f;f++)k[l+f]=a.item.getSize().y+g+c}j+=this.colWidth+g,l++}return this.element.setStyle("height",Math.max.apply(Math,k)),this}.protect(),onLoad:function(a){(!a||"load"===a.type&&a.target.complete||"error"===a.type&&!a.target.complete)&&this.imagesLoaded++,this.imagesLoaded===this.images.length&&this.render()},onResize:function(){this.refresh()}}),c.create("matrix",function(a){return new c.Matrix(this,a)}),c.Modal=new Class({Extends:c.Component,Binds:["onSubmit","onKeydown"],blackout:null,drag:null,elementBody:null,options:{delegate:".js-modal",animation:"fade",ajax:!0,blackout:!0,fullScreen:!1,stopScroll:!0,getContent:"data-modal",template:'<div class="modal"><div class="modal-outer"><div class="modal-inner"></div><button class="modal-close modal-hide"><span class="x"></span></button></div></div>'},initialize:function(a,b){this.parent(b),this.nodes=a,this.createElement(),b=this.options,b.fullScreen&&this.element.addClass("is-fullscreen"),b.blackout&&(this.blackout=c.Blackout.factory(),b.stopScroll&&this.blackout.addEvent("hide",function(a){a&&document.body.removeClass("no-scroll")})),this.element.set("role","dialog").aria("labelledby",this.id()).aria("describedby",this.id()),this.events={"keydown window":"onKeydown","clickout element":"onHide","clickout document {selector}":"onHide","click document {selector}":"onShow","click element .@modal-hide":"onHide","click element .@modal-submit":"onSubmit"},this.enable(),this.fireEvent("init")},hide:function(){return this.blackout&&this.blackout.hide(),this.parent()},position:function(b){if(b===!0)return this;this.blackout&&this.blackout.hideLoader();var c=this.element.getElement("."+d+"modal-inner");return c.set("html",b),this.fireEvent("load",b),this.element.reveal(),this.options.fullScreen&&c.setStyle("min-height",a.getHeight()),this.fireEvent("show"),this},show:function(a,b){var c=this.options,d=c.ajax;return b?d=!1:a&&(this.node=a,d=this.readOption(a,"ajax"),b=this.readValue(a,this.readOption(a,"getContent"))||a.get("href"),b&&b.match(/^#[a-z0-9_\-\.:]+$/i)&&(d=!1)),b?(this.blackout&&!this.element.isShown()&&this.blackout.show(),c.stopScroll&&document.body.addClass("no-scroll"),d?this.cache[b]?this.position(this.cache[b]):this.requestData(b):this.position(b),this):this},onKeydown:function(a){"esc"===a.key&&this.element.isShown()&&this.hide()},onSubmit:function(b){b.preventDefault();var c=b.target,d=this.element.getElement("form");if(d){this.fireEvent("submit",[c,d]);var e={url:d.get("action"),method:d.get("method").toUpperCase()};e.data=a.FormData?new FormData(d):d.toQueryString(),this.requestData(e)}}}),c.create("modal",function(a){return new c.Modal(this,a)},!0),c.Pin=new Class({Extends:c.Component,Binds:["onResize","onScroll"],viewport:null,elementSize:null,parentSize:null,elementTop:null,active:!0,options:{location:"right",xOffset:0,yOffset:0,throttle:50,fixed:!1,calculate:!1,lock:!0},initialize:function(a,b){this.parent(b),this.element=a,this.options=this.inheritOptions(this.options,a),a.set("role","complementary").addClass(d+"pin").addClass(b.animation),this.elementTop=a.getStyle("top").toInt();var c,e=this.options.throttle;this.events=c={"ready document":"onResize"},c["scroll:throttle("+e+") window"]="onScroll",c["resize:throttle("+e+") window"]="onResize",this.enable(),this.fireEvent("init")},calculate:function(){var b=this.options;return this.viewport=a.getSize(),this.elementSize=this.element.getCoordinates(),this.parentSize=this.element.getParent(b.context).getCoordinates(),this.active=b.lock&&this.elementSize.height>=this.viewport.y?!1:this.element.isVisible()&&this.parentSize.height>this.elementSize.height,this},doDestroy:function(){this.active=!1,this.element.reveal(),setTimeout(function(){this.element.removeProperty("style").removeClass("is-pinned")}.bind(this),15)},pin:function(){if(this.options.calculate&&this.calculate(),this.active){var b=this.options,c=b.fixed,d=this.elementSize,e=this.elementTop,f=this.parentSize,g=a.getScroll(),h={},i=b.xOffset,j=0;if(g.y<f.top)return void this.element.removeProperty("style").removeClass("is-pinned");var k=g.y+d.height,l=f.height+f.top;c?k>=l?(j="auto",h.position="absolute",h.bottom=0):(h.position="fixed",h.bottom="auto"):(h.position="absolute",j+=k>=l?f.height-d.height:g.y-f.top+b.yOffset,e&&e>j&&(j=e)),h[b.location]=i,h.top=j,this.element.setStyles(h).addClass("is-pinned")}},onResize:function(){this.calculate(),this.pin(),this.fireEvent("resize")},onScroll:function(){this.pin(),this.fireEvent("scroll")}}),c.create("pin",function(a){return new c.Pin(this,a)}),c.Tooltip=new Class({Extends:c.Component,Binds:["onFollow"],elementHead:null,elementBody:null,options:{delegate:".js-tooltip",mode:"hover",ajax:!1,follow:!1,position:"top-center",showLoading:!0,showTitle:!0,getTitle:"title",getContent:"data-tooltip",mouseThrottle:50,xOffset:0,yOffset:0,delay:0,template:'<div class="tooltip"><div class="tooltip-inner"><div class="tooltip-head"></div><div class="tooltip-body"></div></div><div class="tooltip-arrow"></div></div>'},runtime:{},initialize:function(a,b){this.parent(b),this.nodes=a,this.createElement(),b=this.options;var c="data"+this.cssClass+"-title";this.elementHead=this.element.getElement("."+d+this.cssClass+"-head"),this.elementBody=this.element.getElement("."+d+this.cssClass+"-body"),this.element.set("role","tooltip").removeClass(b.className),this.nodes.each(function(a){a.setProperty(c,a.get("title")).removeProperty("title")}),"title"===b.getTitle&&(b.getTitle=c);var e={"{mode} document {selector}":"onShow"};"click"===b.mode?(e["clickout element"]="onHide",e["clickout document {selector}"]="onHide"):e["mouseleave document {selector}"]="onHide",this.events=e,this.enable(),this.fireEvent("init")},hide:function(){var a=this.options,b=this.element,d=b.get("data-new-position")||this.runtime.position||a.position,e=this.runtime.className||a.className,f=function(){b.removeClass(d).removeClass(e).removeProperty("data-new-position")};return this.runtime={},a.animation?b.one(c.transitionEnd,f):f(),this.node&&this.node.removeProperty("aria-describedby"),this.parent()},position:function(a,b){var c=Object.keys(this.runtime).length?this.runtime:this.options;if(a===!0)return this;if(this.element.addClass(c.position).addClass(c.className),this.node&&this.node.aria("describedby",this.id()),b=b||this.readValue(this.node,c.getTitle),b&&c.showTitle?this.elementHead.set("html",b).show():this.elementHead.hide(),a?this.elementBody.set("html",a).show():this.elementBody.hide(),this.fireEvent("load",a),c.follow){var d="mousemove:throttle("+c.mouseThrottle+")";this.node.removeEvent(d,this.onFollow).addEvent(d,this.onFollow),this.fireEvent("show")}else this.element.positionTo(c.position,this.node,{left:c.xOffset,top:c.yOffset}),setTimeout(function(){this.element.reveal(),this.fireEvent("show")}.bind(this),c.delay||0);return this},show:function(a,b,d){var e;return a?(this.node=a,this.runtime=e=this.inheritOptions(this.options,a),b=b||this.readValue(a,e.getContent)):this.runtime=e=this.options,b?(e.ajax?this.cache[b]?this.position(this.cache[b],d):(e.showLoading&&this.position(c.messages.loading),this.requestData(b)):this.position(b,d),this):this},onFollow:function(a){a.preventDefault();var b=this.runtime;this.element.positionTo(b.position,a,{left:b.xOffset,top:b.yOffset},!0).reveal()}}),c.create("tooltip",function(a){return new c.Tooltip(this,a)},!0),c.Popover=new Class({Extends:c.Tooltip,options:{delegate:".js-popover",getContent:"data-popover",template:'<div class="popover"><div class="popover-inner"><div class="popover-head"></div><div class="popover-body"></div></div><div class="popover-arrow"></div></div>'},initialize:function(a,b){b=b||{},b.mode="click",b.follow=!1,this.parent(a,b)}}),c.create("popover",function(a){return new c.Popover(this,a)},!0),c.Showcase=new Class({Extends:c.Component,Binds:["next","prev","onJump","onSwipe","onKeydown"],items:null,tabs:null,caption:null,data:[],index:-1,blackout:null,options:{delegate:".js-showcase",blackout:!0,stopScroll:!0,gutter:50,getCategory:"data-showcase",getImage:"href",getTitle:"title",template:'<div class="showcase"><div class="showcase-inner"><ul class="showcase-items"></ul><ol class="showcase-tabs bullets"></ol><button class="showcase-prev"><span class="arrow-left"></span></button><button class="showcase-next"><span class="arrow-right"></span></button></div><button class="showcase-close showcase-hide"><span class="x"></span></button><div class="showcase-caption"></div></div>'},initialize:function(a,b){this.parent(b),this.nodes=a,this.createElement(),this.items=this.element.getElement("."+d+"showcase-items"),this.tabs=this.element.getElement("."+d+"showcase-tabs"),this.caption=this.element.getElement("."+d+"showcase-caption"),this.options.blackout&&(this.blackout=c.Blackout.factory()),this.events={"clickout element":"onHide","clickout document {selector}":"onHide","swipe element":"onSwipe","keydown window":"onKeydown","click document {selector}":"onShow","click element .@showcase-hide":"onHide","click element .@showcase-next":"next","click element .@showcase-prev":"prev","click element .@showcase-tabs a":"onJump"},this.enable(),this.fireEvent("init")},hide:function(){return this.blackout&&this.blackout.hide(),this.options.stopScroll&&document.body.removeClass("no-scroll"),this.parent(function(){this.element.removeClass("is-single"),this.items.removeProperty("style").getElements("li").conceal()}.bind(this)),this},jump:function(a){if(a=Number.from(a).bound(this.data.length),a===this.index)return this;var b=this,d=this.element,e=this.caption,f=this.items,g=f.getElements("li"),h=g[a],i=this.data,j=i[a];if(this.tabs){var k=this.tabs.getElements("a");k.removeClass("is-active"),k[a].addClass("is-active")}g.conceal(),e.conceal(),g.addEvent(c.transitionEnd,function(a){a.stopPropagation()});var l=function(){e.set("html",j.title).reveal(),h.reveal(),b.position()};if(f.addEvent(c.transitionEnd+":once",l),h.hasAttribute("data-width"))this._resize(h.get("data-width").toInt(),h.get("data-height").toInt()),c.hasTransition||l();else{d.addClass("is-loading").aria("busy",!0);var m=new Image;m.src=j.image,m.onload=function(){b._resize(this.width,this.height),d.removeClass("is-loading").aria("busy",!1),h.set("data-width",this.width).set("data-height",this.height).grab(m),c.hasTransition||l()},m.onerror=function(){d.removeClass("is-loading").addClass("has-failed").aria("busy",!1),h.set("data-width",150).set("data-height",150).set("html",c.messages.error),b._resize(150,150),c.hasTransition||l()}}return this.index=a,this.fireEvent("jump",a),this},next:function(){return this.jump(this.index+1),this},position:function(){return this.blackout&&this.blackout.hideLoader(),this.element.reveal(),this.fireEvent("show"),this},prev:function(){return this.jump(this.index-1),this},show:function(a){this.node=a,this.index=-1,this.element.addClass("is-loading").aria("busy",!0);var b=this.inheritOptions(this.options,a),c=this.readValue,d=c(a,b.getCategory),e=[],f=0;if(d)for(var g,h=0,i=0;g=this.nodes[h];h++)c(g,b.getCategory)===d&&(g===a&&(f=i),e.push({title:c(g,b.getTitle),category:d,image:c(g,b.getImage)}),i++);else e.push({title:c(a,b.getTitle),category:d,image:c(a,b.getImage)});return this.blackout&&this.blackout.show(),b.stopScroll&&document.body.addClass("no-scroll"),this._buildItems(e),this.jump(f),this},_buildItems:function(a){this.data=a,this.items.empty(),this.tabs.empty();for(var b,c,d,e=0;d=a[e];e++)b=new Element("li"),b.inject(this.items),c=new Element("a").set("href","javascript:;").set("data-index",e),b=new Element("li"),b.inject(this.tabs).grab(c);return a.length<=1&&this.element.addClass("is-single"),this.fireEvent("load",a),this}.protect(),_resize:function(b,c){var d,e,f=a.getSize(),g=2*this.options.gutter,h=f.x-g,i=f.y-g;return b>h?(d=b/c,e=b-h,b=h,c-=Math.round(e/d)):c>i&&(d=c/b,e=c-i,b-=Math.round(e/d),c=i),this.items.setStyles({width:b,height:c}),this},onJump:function(a){a.preventDefault(),this.jump(a.target.get("data-index")||0)},onKeydown:function(a){if(this.isVisible())switch(["up","down","left","right"].contains(a.key)&&a.preventDefault(),a.key){case"esc":this.hide();break;case"up":this.jump(0);break;case"down":this.jump(-1);break;case"left":this.prev();break;case"right":this.next()}},onSwipe:function(a){"left"===a.direction?this.next():"right"===a.direction&&this.prev()}}),c.create("showcase",function(a){return new c.Showcase(this,a)},!0),c.Stalker=new Class({Extends:c.Component,Binds:["onScroll"],container:null,targets:[],markers:[],offsets:[],options:{target:"",targetBy:"href",marker:"",markBy:"id",threshold:50,throttle:50,onlyWithin:!0,applyToParent:!0},initialize:function(b,c){if(this.parent(c),this.element=b,this.container="auto"===b.getStyle("overflow")?b:a,!this.options.target||!this.options.marker)throw new Error("A marker and target is required");b.addClass(d+"stalker");var e;this.events=e={"ready document":"onScroll"},e["scroll:throttle("+this.options.throttle+") container"]="onScroll",this.enable(),this.fireEvent("init"),this.refresh()},activate:function(a){return this._stalk(a,"activate"),this},deactivate:function(a){return this._stalk(a,"deactivate"),this},doDestroy:function(){var a=this.targets,b=this.markers;a.removeClass(d+"stalker-target"),b.removeClass(d+"stalker-marker"),this.options.applyToParent?(a.getParent().removeClass("is-active"),b.getParent().removeClass("is-marked")):(a.removeClass("is-active"),b.removeClass("is-marked"))},refresh:function(){return"auto"===this.element.getStyle("overflow")&&this.element!==document.body&&(this.element.scrollTop=0),this.targets=$$(this.options.target).addClass(d+"stalker-target"),this.markers=$$(this.options.marker).addClass(d+"stalker-marker"),this.offsets=this.markers.getCoordinates(this.element),this},_stalk:function(a,b){if("activate"!==b||!a.hasClass("is-stalked")){var c=this.options.targetBy,d=this.options.markBy,e="activate"===b?"addClass":"removeClass",f=this.targets.filter(function(b){return b.get(c).replace("#","")===a.get(d)});a[e]("is-stalked"),this.options.applyToParent?f.getParent()[e]("is-active"):f[e]("is-active"),this.fireEvent(b,[a,f])}},onScroll:function(){var a=this.container.getScroll().y,b=this.markers,c=this.offsets,d=this.options.onlyWithin,e=this.options.threshold;b.each(function(b,f){var g=c[f],h=g.top-e,i=g.top+g.height+e;d&&a>=h&&i>=a||!d&&a>=h?this.activate(b):this.deactivate(b)}.bind(this)),this.fireEvent("scroll")}}),c.create("stalker",function(a){return new c.Stalker(this,a)}),c.Tabs=new Class({Extends:c.Component,nav:null,sections:[],tabs:[],index:0,options:{ajax:!0,collapsible:!1,defaultIndex:0,persistState:!1,preventDefault:!0,loadFragment:!0,cookie:null,cookieDuration:30,getUrl:"href",template:!1},initialize:function(a,b){this.parent(b),this.element=a,this.options=b=this.inheritOptions(this.options,a),b.cookie||(b.cookie=a.get("id")),this.sections=a.getElements("."+d+"tabs-section").each(function(a,b){a.set("role","tabpanel").set("id",a.get("id")||this.id("section",b)).aria("labelledby",this.id("tab",b)).conceal()}.bind(this)),this.nav=a.getElement("."+d+"tabs-nav").set("role","tablist"),this.tabs=this.nav.getElements("a").each(function(a,b){a.set({"data-index":b,role:"tab",id:this.id("tab",b)}).aria({controls:this.sections[b].get("id"),selected:!1,expanded:!1}).removeClass("is-active")}.bind(this)),this.events={},this.events["{mode} element .@tabs-nav a"]="onShow","click"!==b.mode&&b.preventDefault&&(this.events["click element .@tabs-nav a"]=function(a){a.preventDefault()}),this.enable(),this.fireEvent("init");var c=b.defaultIndex;if(b.persistState&&(c=Number.from(Cookie.read("toolkit.tabs."+b.cookie))),!c&&b.loadFragment&&location.hash){var e=this.tabs.filter(function(a){return a.get("href")===location.hash});e[0]&&(c=e[0].get("data-index"))}c&&this.tabs[c]||(c=0),this.jump(c)},doDestroy:function(){this.element.reveal(),this.sections[this.index].reveal()},hide:function(){return this.sections.conceal(),this.fireEvent("hide",this.node),this},jump:function(a){return this.show(this.tabs[Number.from(a).bound(this.tabs.length)])},show:function(a){var b=a.get("data-index"),d=this.sections[b],e=this.options,f=this.readOption(a,"ajax"),g=this.readValue(a,this.readOption(a,"getUrl"));return f&&g&&"#"!==g.substr(0,1)&&!this.cache[g]&&this.requestData(g,function(){d.set("html",c.messages.loading).addClass("is-loading").aria("busy",!0)}.bind(this),function(a){e.cache&&(this.cache[g]=!0),this.fireEvent("load",a),d.set("html",a).removeClass("is-loading").aria("busy",!1)}.bind(this),function(){d.set("html",c.messages.error).removeClass("is-loading").addClass("has-failed").aria("busy",!1)}.bind(this)),this.tabs.aria({selected:!1,expanded:!1}).getParent().removeClass("is-active"),b===this.index&&e.collapsible?d.isVisible()?d.conceal():(a.aria({selected:!0,expanded:!0}).getParent().addClass("is-active"),d.reveal()):(this.hide(),a.aria({selected:!0,expanded:!0}).getParent().addClass("is-active"),d.reveal()),e.persistState&&Cookie.write("toolkit.tabs."+e.cookie,b,{duration:e.cookieDuration}),this.index=b,this.node=a,this.fireEvent("show",a),this},onShow:function(a,b){(this.options.preventDefault||this.options.ajax&&"#"!==a.target.get("href").substr(0,1))&&a.preventDefault(),this.show(b)}}),c.create("tabs",function(a){return new c.Tabs(this,a)}),c.TypeAhead=new Class({Extends:c.Component,Implements:[Cache],Binds:["source","rewind","onCycle","onFind","onLookup"],input:null,shadow:null,index:-1,items:[],term:"",timer:null,options:{source:[],minLength:1,itemLimit:15,throttle:250,prefetch:!1,shadow:!1,storage:"session",query:{},template:'<div class="type-ahead"></div>',sorter:null,matcher:null,builder:null},initialize:function(a,b){if(this.parent(b),this.createElement(),this.options=b=this.inheritOptions(this.options,a),this.input=a,"input"!==a.get("tag"))throw new Error("TypeAhead must be initialized on an input field");if(this.setStorage(b.storage),Object.each({sorter:"sort",matcher:"match",builder:"build"},function(a,c){if(b[c]!==!1){var d;d=null===b[c]||"function"!==typeOf(b[c])?this[a]:b[c],this.options[c]=d.bind(this)}}.bind(this)),b.prefetch&&"string"===typeOf(b.source)){var c=b.source;new Request.JSON({url:c,data:b.query,onSuccess:function(a){this.setCache(c,a)}.bind(this)}).get()}b.shadow&&(this.node=new Element("div."+d+"type-ahead-shadow").wraps(this.input),this.shadow=this.input.clone().addClass("is-shadow").removeProperty("id").set("readonly",!0).aria("readonly",!0).inject(this.node,"top"),this.input.addClass("not-shadow")),a.set({autocomplete:"off",autocapitalize:"off",autocorrect:"off",spellcheck:"false",role:"combobox"}).aria({autocomplete:"list",owns:this.element.get("id"),expanded:!1}),this.element.set("role","listbox").aria("multiselectable",!1),this.events={"keyup input":"onLookup","keydown input":"onCycle","clickout element":"onHide"},this.enable(),this.fireEvent("init")},build:function(a){var b=new Element("a",{href:"javascript:;",role:"option","aria-selected":"false"});return b.grab(new Element("span."+d+"type-ahead-title",{html:this.highlight(a.title)})),a.description&&b.grab(new Element("span."+d+"type-ahead-desc",{html:a.description})),b},doDestroy:function(){this.shadow&&this.input.replaces(this.shadow.getParent()).removeClass("not-shadow")},hide:function(){return this.shadow&&this.shadow.set("value",""),this.input.aria("expanded",!1),this.parent()},highlight:function(a){for(var b,c=this.term.replace(/[\-\[\]\{\}()*+?.,\\^$|#]/g,"\\$&").split(" "),e=function(a){return'<mark class="'+d+'type-ahead-highlight">'+a+"</mark>"},f=0;b=c[f];f++)a=a.replace(new RegExp(b,"ig"),e);return a},lookup:function(a){return this.term=a,this.timer=setTimeout(this.onFind,this.options.throttle),this},match:function(a,b){return a.toLowerCase().indexOf(b.toLowerCase())>=0},position:function(){if(!this.items.length)return this.hide();var a=this.input.getCoordinates();return this.element.setPosition({x:a.left,y:a.top+a.height}).reveal(),this.input.aria("expanded",!0),this},rewind:function(){return this.index=-1,this.element.getElements("li").removeClass("is-active"),this},select:function(a,b){this.index=a;var c=this.element.getElements("li");if(c.removeClass("is-active"),this.element.getElements("a").aria("selected",!1),a>=0){if(this.items[a]){var d=this.items[a];c[a].addClass("is-active").getElements("a").aria("selected",!0),this.input.set("value",d.title),this.fireEvent(b||"select",[d,a])}}else this.input.set("value",this.term),this.fireEvent("reset");return this},sort:function(a){return a.sort(function(a,b){return a.title.localeCompare(b.title)})},source:function(a){if(!this.term.length||!a.length)return this.hide(),this;var b,c=this.options,e={_empty_:[]},f=new Element("ul");this.items=[],this.index=-1,"function"===typeOf(c.sorter)&&(a=c.sorter(a)),"function"===typeOf(c.matcher)&&(a=a.filter(function(a){return c.matcher(a.title,this.term)}.bind(this)));for(var g=0;b=a[g];g++)b.category?(e[b.category]||(e[b.category]=[]),e[b.category].push(b)):e._empty_.push(b);var h=[],i=0;return Object.each(e,function(a,e){var g=new Elements;"_empty_"!==e&&(h.push(null),g.push(new Element("li").addClass(d+"type-ahead-heading").grab(new Element("span",{text:e}))));for(var j,k=0;(b=a[k])&&!(i>=c.itemLimit);k++)j=c.builder(b),j.addEvents({mouseover:this.rewind,click:this.onSelect.pass(h.length,this)}),g.push(new Element("li").grab(j)),h.push(b),i++;g.inject(f)}.bind(this)),this.element.empty().grab(f),this.items=h,this.cache[this.term.toLowerCase()]=h.filter(function(a){return null!==a}),this.fireEvent("load"),this._shadow(),this.position(),this.fireEvent("show"),this},_shadow:function(){if(!this.shadow)return this;var a=this.input.get("value"),b=a.toLowerCase(),c="";if(this.cache[b]&&this.cache[b][0]){var d=this.cache[b][0].title;0===d.toLowerCase().indexOf(b)&&(c=a+d.substr(a.length,d.length-a.length))}return this.shadow.set("value",c),this}.protect(),onCycle:function(a){var b=this.items,c=b.length.limit(0,this.options.itemLimit),d="cycle";if(c&&this.isVisible()){switch(a.key){case"up":this.index-=b[this.index-1]?1:2,this.index<0&&(this.index=c);break;case"down":this.index+=b[this.index+1]?1:2,this.index>=c&&(this.index=-1);break;case"tab":a.preventDefault();for(var e=0;!this.items[e];)e++;d="select",this.index=e,this.hide();break;case"enter":a.preventDefault(),d="select",this.hide();break;case"esc":this.index=-1,this.hide();break;default:return}this.shadow&&this.shadow.set("value",""),this.select(this.index,d)}},onFind:function(){var a=this.term,b=this.options,c=typeOf(b.source);if(this.cache[a.toLowerCase()])this.source(this.cache[a.toLowerCase()]);else if("string"===c){var d=b.source,e=this.getCache(d);if(e)this.source(e);else{var f=b.query;f.term=a,new Request.JSON({url:d,data:f,onSuccess:this.source}).get()}}else if("array"===c)this.source(b.source);else{if("function"!==c)throw new Error("Invalid TypeAhead source type");var g=b.source.attempt([],this);g&&this.source(g)}},onLookup:function(a){if(!["up","down","esc","tab","enter"].contains(a.key)){clearTimeout(this.timer);var b=this.input.get("value").trim();b.length<this.options.minLength?(this.fireEvent("reset"),this.hide()):(this._shadow(),this.lookup(b))}},onSelect:function(a){this.select(a),this.hide()}}),c.create("typeAhead",function(a){return new c.TypeAhead(this,a)})}(window);